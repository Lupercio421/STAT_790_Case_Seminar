---
title: "Prepping the data"
output: html_document
---

```{r}
library(tidyverse)
library(lubridate)
library(RSocrata)
library(tsfknn)
```


```{r}
df_first <- read.socrata(
  "https://data.cityofnewyork.us/resource/ebb7-mvp5.json",
  # app_token = "YOURAPPTOKENHERE",
  # email     = "user@example.com",
  # password  = "fakepassword"
)
```

```{r}
DSNY <- df_first
DSNY$month <- lubridate::parse_date_time(DSNY$month, "%y / %m")
```

##Questions to answer:

- How many variables will be worked with?
- How many years worth of waste data is sufficient enough for training, testing and validating sets of data?
- Which boroughs will be studied?
- Which districts will be studied?
- If working with timeseries models, ensure your variable of interest is turned into a ts object. Research the needed frequency and start dates with this data, as we are looking into monthly waste management values.

```{r}
DSNY_second <- DSNY %>% filter(month >= as.Date("2010-01-01") & month <= as.Date("2021-12-01"))
```

```{r}
#Default borough, unless specified is the Bronx
#default communitydistrict is 01
DSNY_second %>% 
  group_by(borough, communitydistrict) %>% 
  slice(-(1:12))
```
```{r}
DSNY_second %>% 
  slice(n() -19:0)
```

Run the code chunk below when you have decided on all the necessary variables that can be created and used on the DSNY data

```{r}
# DSNY_validation <- DSNY %>% filter(month >= as.Date("2021-01-01") & month <= as.Date("2021-12-01"))
```


```{r}
?knn_forecasting
?as.ts()
```

## NYC DOE School Enrollment

Link for Open Data: https://data.cityofnewyork.us/browse?q=Enrollment%20Statistics%20by%20District&sortBy=relevance


```{r}
#https://dev.socrata.com/foundry/data.cityofnewyork.us/e649-r223
doe_first <- read.socrata(
  "https://data.cityofnewyork.us/resource/e649-r223.json",
  # app_token = "YOURAPPTOKENHERE",
  # email     = "user@example.com",
  # password  = "fakepassword"
)
```

```{r}
glimpse(doe_first)
```

We dont necessarily need to convert the year into a posixct. This represents a school year. I.e 2020-2021

My next goal is to explore how column sum or row sum will work on this data set. But first we need to convert the grades from characters to integers

```{r}
#doe_first <- doe_first_copy
doe_first_copy <- doe_first
doe_first[,4:19] <- lapply(doe_first[,4:19], as.integer)

#Line 90 will convert all the NA's in the integer columns into zeros
#doe_first %>% mutate_if(is.integer, function(x){ifelse(is.na(x), 0,x)})
# doe_first %>% 
#   summarise(across(doe_first[,4:19]), ~sum(., is.na(.), 0))

```
```{r}
doe_first %>% 
  mutate(across(doe_first[, 4:19], ~ sum(., is.na(.), 0)))
```

```{r}
doe_first %>% summarise(across(where(is.numeric), ~ sum(.x)))
```

```{r}
doe_first <- doe_first %>% 
  mutate(Total = select(., pk:se1) %>% rowSums(na.rm = TRUE))
```


```{r}
# doe_first %>% 
#   mutate(total_sum = summarise(across(where(is.numeric), ~ sum(.x))))
```

```{r}
glimpse(doe_first)
```

